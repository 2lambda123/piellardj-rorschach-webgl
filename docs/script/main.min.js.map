{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ts/gl-utils/gl-canvas.ts","webpack:///./src/ts/gl-utils/gl-resource.ts","webpack:///./src/ts/parameters.ts","webpack:///./src/ts/main.ts","webpack:///./src/ts/gl-utils/viewport.ts","webpack:///./src/ts/gl-utils/shader-manager.ts","webpack:///./src/ts/gl-utils/shader.ts","webpack:///./src/ts/gl-utils/shader-sources.ts","webpack:///./src/ts/gl-utils/vbo.ts","webpack:///./src/ts/time.ts","webpack:///./src/ts/rorschach-face.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","gl","initGL","flags","setError","message","Page","Demopage","setErrorMessage","canvas","Canvas","getCanvas","getContext","disable","CULL_FACE","DEPTH_TEST","BLEND","clearColor","adjustSize","hidpi","cssPixel","window","devicePixelRatio","width","Math","floor","clientWidth","height","clientHeight","this","_gl","GLResource","controlId","Checkbox","isChecked","Range","getValue","addSpeedChangeObserver","callback","addObserver","addWatchmenModeChange","Parameters","shader","canvasSizeChanged","mainLoop","GLCanvas","Viewport","setFullCanvas","aspectRatio","getAspectRatio","u","adjustToCanvasSize","time","getTime","sharpness","density","watchmenMode","bindUniforms","drawArrays","TRIANGLE_STRIP","requestAnimationFrame","Observers","canvasResize","push","RorschachFace","setVisibility","randomScalar","random","showLoader","ShaderManager","buildShader","fragmentFilename","vertexFilename","injected","SEED","toString","builtShader","a","VBO","createQuad","use","bindAttributes","main","left","lower","viewport","drawingBufferWidth","drawingBufferHeight","set","cachedShaders","infos","sourcesPending","sourcesFailed","loadedSource","success","processSource","source","replace","match","vert","ShaderSources","getSource","frag","processedVert","processedFrag","Shader","loadSource","getShader","registerShader","callAndClearCallbacks","cached","callbacks","cachedCallback","failed","pending","deleteShader","freeGLResources","notImplemented","alert","types","str","binder","location","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","Array","isArray","uniform1iv","uniform1fv","uniform1f","vertexSource","fragmentSource","createShader","type","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","id","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","useProgram","currTextureUnitNb","keys","forEach","uName","uniform","loc","aName","attribute","bindUniformsAndAttributes","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","size","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","cachedSources","filename","text","XMLHttpRequest","open","onload","readyState","status","responseText","statusText","onerror","send","Usage","array","staticUsage","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","DYNAMIC_DRAW","normalize","stride","offset","usage","STATIC","DYNAMIC","minX","minY","maxX","maxY","Float32Array","FLOAT","deleteBuffer","enableVertexAttribArray","vertexAttribPointer","setData","lastCheckpoint","lastCheckpointTime","updateCheckpoint","newCheckpoint","Date","now","speed","currentTimeInMs","newSpeed","htmlElement","isAttached","visible","document","createElement","canvasContainer","getCanvasContainer","removeChild","appendChild"],"mappings":"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","file":"main.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","import \"../page-interface-generated\";\r\n\r\nlet gl: WebGLRenderingContext = null;\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(flags?: object): boolean {\r\n    function setError(message: string): void {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    gl = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (gl == null) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (gl == null) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return false;\r\n        }\r\n\r\n        setError(`Your browser or device only supports experimental WebGL.\r\nThe simulation may not run as expected.`);\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    return true;\r\n}\r\n\r\n/* Adjusts the GL canvas size to the actual canvas element size on the page */\r\nfunction adjustSize(hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width !== width || canvas.height !== height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport {\r\n    adjustSize,\r\n    initGL,\r\n    gl,\r\n};\r\n","abstract class GLResource {\r\n    private _gl: WebGLRenderingContext;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        this._gl = gl;\r\n    }\r\n\r\n    public gl(): WebGLRenderingContext {\r\n        return this._gl;\r\n    }\r\n\r\n    public abstract freeGLResources(): void;\r\n}\r\n\r\nexport { GLResource };\r\n","import \"./page-interface-generated\";\r\n\r\n/* === IDs ============================================================ */\r\nconst controlId = {\r\n    TIME: \"time-checkbox-id\",\r\n    SPEED: \"speed-range-id\",\r\n    SHARPNESS: \"sharpness-range-id\",\r\n    DENSITY: \"density-range-id\",\r\n    WATCHMEN_MODE: \"watchmen-mode-checkbox-id\",\r\n};\r\n\r\nabstract class Parameters {\r\n    public static get time(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.TIME);\r\n    }\r\n\r\n    public static get speed(): number {\r\n        return Page.Range.getValue(controlId.SPEED);\r\n    }\r\n\r\n    public static addSpeedChangeObserver(callback: (newSpeed: number) => unknown): void {\r\n        Page.Range.addObserver(controlId.SPEED, callback);\r\n    }\r\n\r\n    public static get sharpness(): number {\r\n        return Page.Range.getValue(controlId.SHARPNESS);\r\n    }\r\n\r\n    public static get density(): number {\r\n        return Page.Range.getValue(controlId.DENSITY);\r\n    }\r\n\r\n    public static get watchmenMode(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.WATCHMEN_MODE);\r\n    }\r\n    public static addWatchmenModeChange(callback: (enabled: boolean) => unknown): void {\r\n        Page.Checkbox.addObserver(controlId.WATCHMEN_MODE, callback);\r\n    }\r\n}\r\n\r\nexport {\r\n    Parameters,\r\n}\r\n","import * as GLCanvas from \"./gl-utils/gl-canvas\";\r\nimport { gl } from \"./gl-utils/gl-canvas\";\r\nimport { Viewport } from \"./gl-utils/viewport\";\r\nimport * as ShaderManager from \"./gl-utils/shader-manager\";\r\nimport { Shader } from \"./gl-utils/shader\";\r\nimport { VBO } from \"./gl-utils/vbo\";\r\nimport { Parameters } from \"./parameters\";\r\nimport { getTime } from \"./time\";\r\nimport * as RorschachFace from \"./rorschach-face\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nfunction main(): void {\r\n    let shader: Shader;\r\n\r\n    function adjustToCanvasSize(): void {\r\n        GLCanvas.adjustSize();\r\n        Viewport.setFullCanvas(gl);\r\n\r\n        const aspectRatio = Page.Canvas.getAspectRatio();\r\n        if (aspectRatio >= 1) {\r\n            shader.u[\"uCoordsAdjustment\"].value = [aspectRatio, 1];\r\n        } else if (aspectRatio < 1) {\r\n            shader.u[\"uCoordsAdjustment\"].value = [1, 1 / aspectRatio];\r\n        }\r\n    }\r\n\r\n    let canvasSizeChanged = true;\r\n    Page.Canvas.Observers.canvasResize.push(() => canvasSizeChanged = true);\r\n\r\n    function mainLoop(): void {\r\n        if (canvasSizeChanged) {\r\n            adjustToCanvasSize();\r\n            canvasSizeChanged = false;\r\n        }\r\n\r\n        shader.u[\"uTime\"].value = Parameters.time ? getTime() : 0;\r\n        shader.u[\"uSharpness\"].value = Parameters.sharpness;\r\n        shader.u[\"uThreshold\"].value = 1 - Parameters.density;\r\n        shader.u[\"uWatchmenMode\"].value = Parameters.watchmenMode ? 1 : 0;\r\n\r\n        shader.bindUniforms();\r\n\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n\r\n    Parameters.addWatchmenModeChange(RorschachFace.setVisibility);\r\n    RorschachFace.setVisibility(Parameters.watchmenMode);\r\n\r\n    if (!GLCanvas.initGL()) {\r\n        return;\r\n    }\r\n\r\n    const randomScalar = Math.random() * 200 - 100;\r\n    Page.Canvas.showLoader(true);\r\n    ShaderManager.buildShader(\r\n        {\r\n            fragmentFilename: \"rorschach.frag\",\r\n            vertexFilename: \"rorschach.vert\",\r\n            injected: {\r\n                SEED: randomScalar.toString(),\r\n            },\r\n        },\r\n        (builtShader: Shader | null) => {\r\n            if (builtShader !== null) {\r\n                shader = builtShader;\r\n                shader.a[\"aCoords\"].VBO = VBO.createQuad(gl, -1, -1, 1, 1);\r\n                shader.use();\r\n                shader.bindAttributes();\r\n\r\n                Page.Canvas.showLoader(false);\r\n                requestAnimationFrame(mainLoop);\r\n            } else {\r\n                Page.Demopage.setErrorMessage(\"shaders-loading\", \"Failed to load shaders.\");\r\n            }\r\n        },\r\n    );\r\n}\r\n\r\nmain();","class Viewport {\r\n    public static setFullCanvas(gl: WebGLRenderingContext): void {\r\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    }\r\n\r\n    public lower: number;\r\n    public left: number;\r\n    public width: number;\r\n    public height: number;\r\n\r\n    constructor(left: number, lower: number, width: number, height: number) {\r\n        this.left = left;\r\n        this.lower = lower;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    public set(gl: WebGLRenderingContext): void {\r\n        gl.viewport(this.lower, this.left, this.width, this.height);\r\n    }\r\n}\r\n\r\nexport { Viewport };\r\n","import { gl } from \"./gl-canvas\";\r\nimport { Shader } from \"./shader\";\r\nimport * as ShaderSources from \"./shader-sources\";\r\n\r\ntype RegisterCallback = (success: boolean, shader: Shader | null) => void;\r\n\r\ninterface IShaderInfos {\r\n    fragmentFilename: string;\r\n    vertexFilename: string;\r\n    injected: { [id: string]: string };\r\n}\r\n\r\ninterface ICachedShader {\r\n    shader: Shader | null;\r\n    infos: IShaderInfos;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: RegisterCallback[];\r\n}\r\n\r\nconst cachedShaders: { [id: string]: ICachedShader } = {};\r\n\r\nfunction getShader(name: string): Shader | null {\r\n    return cachedShaders[name].shader;\r\n}\r\n\r\ntype BuildCallback = (builtShader: Shader | null) => void;\r\n\r\nfunction buildShader(infos: IShaderInfos, callback: BuildCallback): void {\r\n    let sourcesPending = 2;\r\n    let sourcesFailed = 0;\r\n\r\n    function loadedSource(success: boolean): void {\r\n        function processSource(source: string): string {\r\n            return source.replace(/#INJECT\\((.*)\\)/mg, (match: string, name: string) => {\r\n                if (infos.injected[name]) {\r\n                    return infos.injected[name];\r\n                }\r\n                return match;\r\n            });\r\n        }\r\n\r\n        sourcesPending--;\r\n        if (!success) {\r\n            sourcesFailed++;\r\n        }\r\n\r\n        if (sourcesPending === 0) {\r\n            let shader = null;\r\n\r\n            if (sourcesFailed === 0) {\r\n                const vert = ShaderSources.getSource(infos.vertexFilename);\r\n                const frag = ShaderSources.getSource(infos.fragmentFilename);\r\n\r\n                const processedVert = processSource(vert);\r\n                const processedFrag = processSource(frag);\r\n\r\n                shader = new Shader(gl, processedVert, processedFrag);\r\n            }\r\n\r\n            callback(shader);\r\n        }\r\n    }\r\n\r\n    ShaderSources.loadSource(infos.vertexFilename, loadedSource);\r\n    ShaderSources.loadSource(infos.fragmentFilename, loadedSource);\r\n}\r\n\r\nfunction registerShader(name: string, infos: IShaderInfos, callback: RegisterCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedShader): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed, cached.shader);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedShaders[name] === \"undefined\") {\r\n        cachedShaders[name] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            infos,\r\n            pending: true,\r\n            shader: null,\r\n        };\r\n        const cached = cachedShaders[name];\r\n\r\n        buildShader(infos, (builtShader: Shader | null) => {\r\n            cached.pending = false;\r\n            cached.failed = builtShader === null;\r\n            cached.shader = builtShader;\r\n\r\n            callAndClearCallbacks(cached);\r\n        });\r\n    } else {\r\n        const cached = cachedShaders[name];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteShader(name: string): void {\r\n    if (typeof cachedShaders[name] !== \"undefined\") {\r\n        if (cachedShaders[name].shader !== null) {\r\n            cachedShaders[name].shader.freeGLResources();\r\n        }\r\n        delete cachedShaders[name];\r\n    }\r\n}\r\n\r\nexport {\r\n    buildShader,\r\n    getShader,\r\n    IShaderInfos,\r\n    registerShader,\r\n    deleteShader,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\nimport { VBO } from \"./vbo\";\r\n\r\nfunction notImplemented(): void {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    } else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    } else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n    gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\ninterface IBindingType {\r\n    str: string;\r\n    binder: (...args: any[]) => unknown;\r\n}\r\nconst types: { [index: string]: IBindingType } = {\r\n    0x8B50: { str: \"FLOAT_VEC2\", binder: bindUniformFloat2v },\r\n    0x8B51: { str: \"FLOAT_VEC3\", binder: bindUniformFloat3v },\r\n    0x8B52: { str: \"FLOAT_VEC4\", binder: bindUniformFloat4v },\r\n    0x8B53: { str: \"INT_VEC2\", binder: bindUniformInt2v },\r\n    0x8B54: { str: \"INT_VEC3\", binder: bindUniformInt3v },\r\n    0x8B55: { str: \"INT_VEC4\", binder: bindUniformInt4v },\r\n    0x8B56: { str: \"BOOL\", binder: bindUniformBool },\r\n    0x8B57: { str: \"BOOL_VEC2\", binder: bindUniformBool2v },\r\n    0x8B58: { str: \"BOOL_VEC3\", binder: bindUniformBool3v },\r\n    0x8B59: { str: \"BOOL_VEC4\", binder: bindUniformBool4v },\r\n    0x8B5A: { str: \"FLOAT_MAT2\", binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: \"FLOAT_MAT3\", binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: \"FLOAT_MAT4\", binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: \"SAMPLER_2D\", binder: bindSampler2D },\r\n    0x8B60: { str: \"SAMPLER_CUBE\", binder: bindSamplerCube },\r\n    0x1400: { str: \"BYTE\", binder: notImplemented },\r\n    0x1401: { str: \"UNSIGNED_BYTE\", binder: notImplemented },\r\n    0x1402: { str: \"SHORT\", binder: notImplemented },\r\n    0x1403: { str: \"UNSIGNED_SHORT\", binder: notImplemented },\r\n    0x1404: { str: \"INT\", binder: bindUniformInt },\r\n    0x1405: { str: \"UNSIGNED_INT\", binder: notImplemented },\r\n    0x1406: { str: \"FLOAT\", binder: bindUniformFloat },\r\n};\r\n\r\ninterface IShaderUniform {\r\n    value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n    loc: WebGLUniformLocation;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\ninterface IShaderAttribute {\r\n    VBO: VBO;\r\n    loc: GLint;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n    public u: { [name: string]: IShaderUniform };\r\n    public a: { [name: string]: IShaderAttribute };\r\n\r\n    private id: WebGLProgram;\r\n    private uCount: number;\r\n    private aCount: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n        function createShader(type: GLenum, source: string): WebGLShader {\r\n            const shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n\r\n            const compileSuccess = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!compileSuccess) {\r\n                console.error(gl.getShaderInfoLog(shader));\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n\r\n            return shader;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        this.id = null;\r\n        this.uCount = 0;\r\n        this.aCount = 0;\r\n\r\n        const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n        const id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n\r\n        const linkSuccess = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!linkSuccess) {\r\n            console.error(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        } else {\r\n            this.id = id;\r\n\r\n            this.introspection();\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteProgram(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public use(): void {\r\n        super.gl().useProgram(this.id);\r\n    }\r\n\r\n    public bindUniforms(): void {\r\n        const gl: WebGLRenderingContext = super.gl();\r\n        let currTextureUnitNb: number = 0;\r\n\r\n        Object.keys(this.u).forEach((uName: string) => {\r\n            const uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    const unitNb: number = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                } else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        Object.keys(this.a).forEach((aName: string) => {\r\n            const attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindUniformsAndAttributes(): void {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    }\r\n\r\n    private introspection(): void {\r\n        const gl = super.gl();\r\n\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = {};\r\n        for (let i = 0; i < this.uCount; i++) {\r\n            const uniform = gl.getActiveUniform(this.id, i);\r\n            const name = uniform.name;\r\n\r\n            this.u[name] = {\r\n                loc: gl.getUniformLocation(this.id, name),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n                value: null,\r\n            };\r\n        }\r\n\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = {};\r\n        for (let i = 0; i < this.aCount; i++) {\r\n            const attribute = gl.getActiveAttrib(this.id, i);\r\n            const name = attribute.name;\r\n\r\n            this.a[name] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport { ShaderProgram as Shader };\r\n","type LoadCallback = (success: boolean)  => void;\r\n\r\ninterface ICachedSource {\r\n    text: string;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: LoadCallback[];\r\n}\r\n\r\nconst cachedSources: { [id: string]: ICachedSource } = {};\r\n\r\n/* Fetches asynchronously the shader source from server and stores it in cache. */\r\nfunction loadSource(filename: string, callback: LoadCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedSource): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedSources[filename] === \"undefined\") {\r\n        cachedSources[filename] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            pending: true,\r\n            text: null,\r\n        };\r\n        const cached = cachedSources[filename];\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", \"./shaders/\" + filename, true);\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                cached.pending = false;\r\n\r\n                if (xhr.status === 200) {\r\n                    cached.text = xhr.responseText;\r\n                    cached.failed = false;\r\n                } else {\r\n                    console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n                    cached.failed = true;\r\n                }\r\n\r\n                callAndClearCallbacks(cached);\r\n            }\r\n        };\r\n        xhr.onerror = () => {\r\n            console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n            cached.pending = false;\r\n            cached.failed = true;\r\n            callAndClearCallbacks(cached);\r\n        };\r\n\r\n        xhr.send(null);\r\n    } else {\r\n        const cached = cachedSources[filename];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            cached.callbacks = [callback];\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSource(filename: string): string {\r\n    return cachedSources[filename].text;\r\n}\r\n\r\nexport {\r\n    getSource,\r\n    loadSource,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\n\r\nenum Usage {\r\n    DYNAMIC,\r\n    STATIC,\r\n}\r\n\r\nclass VBO extends GLResource {\r\n    public static createQuad(gl: WebGLRenderingContext, minX: number, minY: number, maxX: number, maxY: number): VBO {\r\n        const vert = [\r\n            minX, minY,\r\n            maxX, minY,\r\n            minX, maxY,\r\n            maxX, maxY,\r\n        ];\r\n\r\n        return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT, true);\r\n    }\r\n\r\n    private id: WebGLBuffer;\r\n    private size: number;\r\n    private type: GLenum;\r\n    private normalize: GLboolean;\r\n    private stride: GLsizei;\r\n    private offset: GLintptr;\r\n    private usage: Usage;\r\n\r\n    constructor(gl: WebGLRenderingContext, array: any, size: number, type: GLenum, staticUsage: boolean = true) {\r\n        super(gl);\r\n\r\n        this.id = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (staticUsage) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n        this.size = size;\r\n        this.type = type;\r\n        this.normalize = false;\r\n        this.stride = 0;\r\n        this.offset = 0;\r\n        this.usage = (staticUsage) ? Usage.STATIC : Usage.DYNAMIC;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        this.gl().deleteBuffer(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public bind(location: GLuint): void {\r\n        const gl = super.gl();\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n    }\r\n\r\n    public setData(array: any): void {\r\n        const gl = super.gl();\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (this.usage === Usage.STATIC) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n}\r\n\r\nexport { VBO };\r\n","import { Parameters } from \"./parameters\";\r\n\r\n\r\nlet lastCheckpoint: number; // in relative time\r\nlet lastCheckpointTime: number; // in actual time\r\n\r\nfunction updateCheckpoint(newCheckpoint: number): void {\r\n    lastCheckpoint = newCheckpoint;\r\n    lastCheckpointTime = Date.now();\r\n}\r\nupdateCheckpoint(0);\r\n\r\nlet speed = Parameters.speed;\r\nfunction updateSpeed(): void {\r\n    const newSpeed = Parameters.speed;\r\n    updateCheckpoint(currentTimeInMs());\r\n    speed = newSpeed;\r\n}\r\nParameters.addSpeedChangeObserver(updateSpeed);\r\n\r\nfunction currentTimeInMs(): number {\r\n    return lastCheckpoint + speed * (Date.now() - lastCheckpointTime);\r\n}\r\n\r\n/* Elapsed time in seconds since the application start.\r\n * This time is relative and can be slowed down and made quicker with controls. */\r\nfunction getTime(): number {\r\n    return 0.001 * currentTimeInMs();\r\n}\r\n\r\nexport { getTime }","import \"./page-interface-generated\";\r\n\r\nlet htmlElement: HTMLElement = null;\r\nlet isAttached = false;\r\n\r\nfunction createElementIfNeeded(): void {\r\n    if (htmlElement === null) {\r\n        htmlElement = document.createElement(\"div\");\r\n        htmlElement.id = \"rorschach-face\";\r\n    }\r\n}\r\n\r\nfunction setVisibility(visible: boolean): void {\r\n    if (isAttached !== visible) {\r\n        createElementIfNeeded();\r\n\r\n        const canvasContainer = Page.Canvas.getCanvasContainer();\r\n        if (!isAttached) {\r\n            canvasContainer.appendChild(htmlElement);\r\n        } else {\r\n            canvasContainer.removeChild(htmlElement);\r\n        }\r\n        isAttached = visible;\r\n    }\r\n}\r\n\r\nexport { setVisibility }\r\n"],"sourceRoot":""}