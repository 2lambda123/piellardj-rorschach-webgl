{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ts/gl-utils/gl-canvas.ts","webpack:///./src/ts/parameters.ts","webpack:///./src/ts/gl-utils/gl-resource.ts","webpack:///./src/ts/main.ts","webpack:///./src/ts/gl-utils/viewport.ts","webpack:///./src/ts/time.ts","webpack:///./src/ts/rorschach-face.ts","webpack:///./src/ts/shader-picker.ts","webpack:///./src/ts/gl-utils/shader-manager.ts","webpack:///./src/ts/gl-utils/shader.ts","webpack:///./src/ts/gl-utils/shader-sources.ts","webpack:///./src/ts/gl-utils/vbo.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","gl","initGL","flags","setError","message","Page","Demopage","setErrorMessage","canvas","Canvas","getCanvas","getContext","disable","CULL_FACE","DEPTH_TEST","BLEND","clearColor","adjustSize","hidpi","cssPixel","window","devicePixelRatio","width","Math","floor","clientWidth","height","clientHeight","controlId","Controls","setVisibility","Checkbox","isChecked","Range","getValue","addSpeedChangeObserver","callback","addObserver","addWatchmenModeChange","addResizeObserver","Observers","canvasResize","push","Parameters","this","_gl","GLResource","GLCanvas","canvasSizeChanged","enableWatchmenMode","showLoader","ShaderPicker","loadShaders","success","watchmenMode","requestAnimationFrame","mainLoop","currentMode","EMode","WATCHMEN","CLASSIC","shaderChanged","enableShader","currentShader","getCurrentShader","shader","supportHighDPI","Viewport","setFullCanvas","aspectRatio","getAspectRatio","u","adjustToCanvasSize","time","getTime","sharpness","density","scale","symetry","details","bindUniforms","drawArrays","TRIANGLE_STRIP","enabled","RorschachFace","main","left","lower","viewport","drawingBufferWidth","drawingBufferHeight","set","lastCheckpoint","lastCheckpointTime","updateCheckpoint","newCheckpoint","Date","now","speed","currentTimeInMs","newSpeed","htmlElement","isAttached","visible","document","createElement","id","canvasContainer","getCanvasContainer","removeChild","appendChild","shadersList","randomScalar","random","loadShaderInternal","ShaderManager","buildShader","fragmentFilename","vertexFilename","injected","SEED","toString","WATCHMEN_MODE_ID","builtShader","a","VBO","createQuad","errorId","totalSuccess","loadedShaderCallback","allFinished","use","bindAttributes","cachedShaders","infos","sourcesPending","sourcesFailed","loadedSource","processSource","source","replace","match","vert","ShaderSources","getSource","frag","processedVert","processedFrag","Shader","loadSource","getShader","registerShader","callAndClearCallbacks","cached","callbacks","cachedCallback","failed","pending","deleteShader","freeGLResources","notImplemented","alert","types","str","binder","location","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","Array","isArray","uniform1iv","uniform1fv","uniform1f","vertexSource","fragmentSource","createShader","type","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","useProgram","currTextureUnitNb","keys","forEach","uName","uniform","loc","aName","attribute","bindUniformsAndAttributes","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","size","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","cachedSources","filename","text","XMLHttpRequest","open","onload","readyState","status","responseText","statusText","onerror","send","Usage","array","staticUsage","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","DYNAMIC_DRAW","normalize","stride","offset","usage","STATIC","DYNAMIC","minX","minY","maxX","maxY","Float32Array","FLOAT","deleteBuffer","enableVertexAttribArray","vertexAttribPointer","setData"],"mappings":"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","file":"main.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","import \"../page-interface-generated\";\r\n\r\nlet gl: WebGLRenderingContext = null;\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(flags?: object): boolean {\r\n    function setError(message: string): void {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    gl = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (gl == null) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (gl == null) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return false;\r\n        }\r\n\r\n        setError(`Your browser or device only supports experimental WebGL.\r\nThe simulation may not run as expected.`);\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    return true;\r\n}\r\n\r\n/* Adjusts the GL canvas size to the actual canvas element size on the page */\r\nfunction adjustSize(hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width !== width || canvas.height !== height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport {\r\n    adjustSize,\r\n    initGL,\r\n    gl,\r\n};\r\n","import \"./page-interface-generated\";\r\n\r\n/* === IDs ============================================================ */\r\nconst controlId = {\r\n    TIME: \"time-checkbox-id\",\r\n    SPEED: \"speed-range-id\",\r\n    SHARPNESS: \"sharpness-range-id\",\r\n    DENSITY: \"density-range-id\",\r\n    WATCHMEN_MODE: \"watchmen-mode-checkbox-id\",\r\n    HIGH_DPI: \"high-dpi-checkbox-id\",\r\n    SCALE: \"scale-range-id\",\r\n    SYMETRY: \"symetry-range-id\",\r\n    DETAILS: \"details-range-id\"\r\n};\r\n\r\n\r\nPage.Controls.setVisibility(controlId.HIGH_DPI, window.devicePixelRatio > 1);\r\n\r\nabstract class Parameters {\r\n    public static get time(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.TIME);\r\n    }\r\n\r\n    public static get speed(): number {\r\n        return Page.Range.getValue(controlId.SPEED);\r\n    }\r\n\r\n    public static addSpeedChangeObserver(callback: (newSpeed: number) => unknown): void {\r\n        Page.Range.addObserver(controlId.SPEED, callback);\r\n    }\r\n\r\n    public static get sharpness(): number {\r\n        return Page.Range.getValue(controlId.SHARPNESS);\r\n    }\r\n\r\n    public static get density(): number {\r\n        return Page.Range.getValue(controlId.DENSITY);\r\n    }\r\n\r\n    public static get watchmenMode(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.WATCHMEN_MODE);\r\n    }\r\n    public static addWatchmenModeChange(callback: (enabled: boolean) => unknown): void {\r\n        Page.Checkbox.addObserver(controlId.WATCHMEN_MODE, callback);\r\n    }\r\n\r\n    public static get supportHighDPI(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.HIGH_DPI);\r\n    }\r\n\r\n    public static addResizeObserver(callback: () => unknown): void {\r\n        Page.Checkbox.addObserver(controlId.HIGH_DPI, callback);\r\n        Page.Canvas.Observers.canvasResize.push(callback);\r\n    }\r\n\r\n    public static get scale(): number {\r\n        return Page.Range.getValue(controlId.SCALE);\r\n    }\r\n\r\n    public static get symetry(): number {\r\n        return 2 * Page.Range.getValue(controlId.SYMETRY) - 1;\r\n    }\r\n\r\n    public static get details(): number {\r\n        return Page.Range.getValue(controlId.DETAILS);\r\n    }\r\n}\r\n\r\nexport {\r\n    Parameters,\r\n}\r\n","abstract class GLResource {\r\n    private _gl: WebGLRenderingContext;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        this._gl = gl;\r\n    }\r\n\r\n    public gl(): WebGLRenderingContext {\r\n        return this._gl;\r\n    }\r\n\r\n    public abstract freeGLResources(): void;\r\n}\r\n\r\nexport { GLResource };\r\n","import * as GLCanvas from \"./gl-utils/gl-canvas\";\r\nimport { gl } from \"./gl-utils/gl-canvas\";\r\nimport { Viewport } from \"./gl-utils/viewport\";\r\nimport { Shader } from \"./gl-utils/shader\";\r\n\r\nimport { Parameters } from \"./parameters\";\r\nimport { getTime } from \"./time\";\r\nimport * as RorschachFace from \"./rorschach-face\";\r\nimport * as ShaderPicker from \"./shader-picker\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nfunction main(): void {\r\n    if (!GLCanvas.initGL()) {\r\n        return;\r\n    }\r\n\r\n    function adjustToCanvasSize(shader: Shader): void {\r\n        GLCanvas.adjustSize(Parameters.supportHighDPI);\r\n        Viewport.setFullCanvas(gl);\r\n\r\n        const aspectRatio = Page.Canvas.getAspectRatio();\r\n        if (aspectRatio >= 1) {\r\n            shader.u[\"uCoordsAdjustment\"].value = [aspectRatio, 1];\r\n        } else if (aspectRatio < 1) {\r\n            shader.u[\"uCoordsAdjustment\"].value = [1, 1 / aspectRatio];\r\n        }\r\n    }\r\n\r\n    let canvasSizeChanged = true;\r\n    Parameters.addResizeObserver(() => canvasSizeChanged = true);\r\n\r\n    function mainLoop(): void {\r\n        const currentMode = Parameters.watchmenMode ? ShaderPicker.EMode.WATCHMEN : ShaderPicker.EMode.CLASSIC;\r\n        const shaderChanged = ShaderPicker.enableShader(currentMode);\r\n\r\n        const currentShader = ShaderPicker.getCurrentShader();\r\n\r\n        if (canvasSizeChanged || shaderChanged) {\r\n            adjustToCanvasSize(currentShader);\r\n            canvasSizeChanged = false;\r\n        }\r\n\r\n        currentShader.u[\"uTime\"].value = Parameters.time ? getTime() : 0;\r\n        currentShader.u[\"uSharpness\"].value = Parameters.sharpness;\r\n        currentShader.u[\"uThreshold\"].value = 1 - Parameters.density;\r\n        currentShader.u[\"uScale\"].value = Parameters.scale;\r\n        currentShader.u[\"uSymetry\"].value = Parameters.symetry;\r\n        currentShader.u[\"uMaxDetails\"].value = Parameters.details;\r\n\r\n        currentShader.bindUniforms();\r\n\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n\r\n    function enableWatchmenMode(enabled: boolean): void {\r\n        RorschachFace.setVisibility(enabled);\r\n    }\r\n    Parameters.addWatchmenModeChange(enableWatchmenMode);\r\n\r\n    Page.Canvas.showLoader(true);\r\n    ShaderPicker.loadShaders((success: boolean) => {\r\n        if (success) {\r\n            Page.Canvas.showLoader(false);\r\n            enableWatchmenMode(Parameters.watchmenMode);\r\n            requestAnimationFrame(mainLoop);\r\n        } else {\r\n            Page.Demopage.setErrorMessage(\"shaders-loading\", \"Failed to load shaders.\");\r\n        }\r\n    });\r\n}\r\n\r\nmain();\r\n","class Viewport {\r\n    public static setFullCanvas(gl: WebGLRenderingContext): void {\r\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    }\r\n\r\n    public lower: number;\r\n    public left: number;\r\n    public width: number;\r\n    public height: number;\r\n\r\n    constructor(left: number, lower: number, width: number, height: number) {\r\n        this.left = left;\r\n        this.lower = lower;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    public set(gl: WebGLRenderingContext): void {\r\n        gl.viewport(this.lower, this.left, this.width, this.height);\r\n    }\r\n}\r\n\r\nexport { Viewport };\r\n","import { Parameters } from \"./parameters\";\r\n\r\n\r\nlet lastCheckpoint: number; // in relative time\r\nlet lastCheckpointTime: number; // in actual time\r\n\r\nfunction updateCheckpoint(newCheckpoint: number): void {\r\n    lastCheckpoint = newCheckpoint;\r\n    lastCheckpointTime = Date.now();\r\n}\r\nupdateCheckpoint(0);\r\n\r\nlet speed = Parameters.speed;\r\nfunction updateSpeed(): void {\r\n    const newSpeed = Parameters.speed;\r\n    updateCheckpoint(currentTimeInMs());\r\n    speed = newSpeed;\r\n}\r\nParameters.addSpeedChangeObserver(updateSpeed);\r\n\r\nfunction currentTimeInMs(): number {\r\n    return lastCheckpoint + speed * (Date.now() - lastCheckpointTime);\r\n}\r\n\r\n/* Elapsed time in seconds since the application start.\r\n * This time is relative and can be slowed down and made quicker with controls. */\r\nfunction getTime(): number {\r\n    return 0.001 * currentTimeInMs();\r\n}\r\n\r\nexport { getTime }","import \"./page-interface-generated\";\r\n\r\nlet htmlElement: HTMLElement = null;\r\nlet isAttached = false;\r\n\r\nfunction createElementIfNeeded(): void {\r\n    if (htmlElement === null) {\r\n        htmlElement = document.createElement(\"div\");\r\n        htmlElement.id = \"rorschach-face\";\r\n    }\r\n}\r\n\r\nfunction setVisibility(visible: boolean): void {\r\n    if (isAttached !== visible) {\r\n        createElementIfNeeded();\r\n\r\n        const canvasContainer = Page.Canvas.getCanvasContainer();\r\n        if (!isAttached) {\r\n            canvasContainer.appendChild(htmlElement);\r\n        } else {\r\n            canvasContainer.removeChild(htmlElement);\r\n        }\r\n        isAttached = visible;\r\n    }\r\n}\r\n\r\nexport { setVisibility }\r\n","import { gl } from \"./gl-utils/gl-canvas\";\r\nimport { Shader } from \"./gl-utils/shader\";\r\nimport * as ShaderManager from \"./gl-utils/shader-manager\";\r\nimport { VBO } from \"./gl-utils/vbo\";\r\n\r\nconst shadersList: Shader[] = [null, null];\r\n\r\nenum EMode {\r\n    CLASSIC = 0, // index of this shader in the array\r\n    WATCHMEN = 1, // index of this shader in the array\r\n}\r\nlet currentMode: EMode | null = null;\r\n\r\nconst randomScalar = Math.random() * 200 - 100;\r\n\r\nfunction loadShaderInternal(mode: EMode, callback: (success: boolean) => unknown): void {\r\n    ShaderManager.buildShader(\r\n        {\r\n            fragmentFilename: \"rorschach.frag\",\r\n            vertexFilename: \"rorschach.vert\",\r\n            injected: {\r\n                SEED: randomScalar.toString(),\r\n                WATCHMEN_MODE_ID: (mode === EMode.WATCHMEN) ? \"1\" : \"0\",\r\n            },\r\n        }, (builtShader: Shader | null) => {\r\n            if (builtShader !== null) {\r\n                builtShader.a[\"aCoords\"].VBO = VBO.createQuad(gl, -1, -1, 1, 1);\r\n                shadersList[mode] = builtShader;\r\n                callback(true);\r\n            } else {\r\n                const errorId = `shader-loading-${mode}`;\r\n                Page.Demopage.setErrorMessage(errorId, `Failed to load/build the shader for the mode '${mode}'.`);\r\n                callback(false);\r\n            }\r\n        }\r\n    );\r\n}\r\n\r\nfunction loadShaders(callback: (success: boolean) => unknown): void {\r\n    let totalSuccess = true;\r\n    function loadedShaderCallback(success: boolean): void {\r\n        totalSuccess = totalSuccess && success;\r\n\r\n        let allFinished = true;\r\n        for (const shader of shadersList) {\r\n            if (shader === null) {\r\n                allFinished = false;\r\n            }\r\n        }\r\n\r\n        if (allFinished) {\r\n            callback(totalSuccess);\r\n        }\r\n    }\r\n\r\n    loadShaderInternal(EMode.CLASSIC, loadedShaderCallback);\r\n    loadShaderInternal(EMode.WATCHMEN, loadedShaderCallback);\r\n}\r\n\r\n/** Returns true if the shader was changed */\r\nfunction enableShader(mode: EMode): boolean {\r\n    if (currentMode !== mode) {\r\n        currentMode = mode;\r\n        shadersList[currentMode].use();\r\n        shadersList[currentMode].bindAttributes();\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction getCurrentShader(): Shader {\r\n    return shadersList[currentMode];\r\n}\r\n\r\nexport {\r\n    EMode,\r\n    enableShader,\r\n    getCurrentShader,\r\n    loadShaders,\r\n};\r\n","import { gl } from \"./gl-canvas\";\r\nimport { Shader } from \"./shader\";\r\nimport * as ShaderSources from \"./shader-sources\";\r\n\r\ntype RegisterCallback = (success: boolean, shader: Shader | null) => void;\r\n\r\ninterface IShaderInfos {\r\n    fragmentFilename: string;\r\n    vertexFilename: string;\r\n    injected: { [id: string]: string };\r\n}\r\n\r\ninterface ICachedShader {\r\n    shader: Shader | null;\r\n    infos: IShaderInfos;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: RegisterCallback[];\r\n}\r\n\r\nconst cachedShaders: { [id: string]: ICachedShader } = {};\r\n\r\nfunction getShader(name: string): Shader | null {\r\n    return cachedShaders[name].shader;\r\n}\r\n\r\ntype BuildCallback = (builtShader: Shader | null) => void;\r\n\r\nfunction buildShader(infos: IShaderInfos, callback: BuildCallback): void {\r\n    let sourcesPending = 2;\r\n    let sourcesFailed = 0;\r\n\r\n    function loadedSource(success: boolean): void {\r\n        function processSource(source: string): string {\r\n            return source.replace(/#INJECT\\((.*)\\)/mg, (match: string, name: string) => {\r\n                if (infos.injected[name]) {\r\n                    return infos.injected[name];\r\n                }\r\n                return match;\r\n            });\r\n        }\r\n\r\n        sourcesPending--;\r\n        if (!success) {\r\n            sourcesFailed++;\r\n        }\r\n\r\n        if (sourcesPending === 0) {\r\n            let shader = null;\r\n\r\n            if (sourcesFailed === 0) {\r\n                const vert = ShaderSources.getSource(infos.vertexFilename);\r\n                const frag = ShaderSources.getSource(infos.fragmentFilename);\r\n\r\n                const processedVert = processSource(vert);\r\n                const processedFrag = processSource(frag);\r\n\r\n                shader = new Shader(gl, processedVert, processedFrag);\r\n            }\r\n\r\n            callback(shader);\r\n        }\r\n    }\r\n\r\n    ShaderSources.loadSource(infos.vertexFilename, loadedSource);\r\n    ShaderSources.loadSource(infos.fragmentFilename, loadedSource);\r\n}\r\n\r\nfunction registerShader(name: string, infos: IShaderInfos, callback: RegisterCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedShader): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed, cached.shader);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedShaders[name] === \"undefined\") {\r\n        cachedShaders[name] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            infos,\r\n            pending: true,\r\n            shader: null,\r\n        };\r\n        const cached = cachedShaders[name];\r\n\r\n        buildShader(infos, (builtShader: Shader | null) => {\r\n            cached.pending = false;\r\n            cached.failed = builtShader === null;\r\n            cached.shader = builtShader;\r\n\r\n            callAndClearCallbacks(cached);\r\n        });\r\n    } else {\r\n        const cached = cachedShaders[name];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteShader(name: string): void {\r\n    if (typeof cachedShaders[name] !== \"undefined\") {\r\n        if (cachedShaders[name].shader !== null) {\r\n            cachedShaders[name].shader.freeGLResources();\r\n        }\r\n        delete cachedShaders[name];\r\n    }\r\n}\r\n\r\nexport {\r\n    buildShader,\r\n    getShader,\r\n    IShaderInfos,\r\n    registerShader,\r\n    deleteShader,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\nimport { VBO } from \"./vbo\";\r\n\r\nfunction notImplemented(): void {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    } else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    } else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n    gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\ninterface IBindingType {\r\n    str: string;\r\n    binder: (...args: any[]) => unknown;\r\n}\r\nconst types: { [index: string]: IBindingType } = {\r\n    0x8B50: { str: \"FLOAT_VEC2\", binder: bindUniformFloat2v },\r\n    0x8B51: { str: \"FLOAT_VEC3\", binder: bindUniformFloat3v },\r\n    0x8B52: { str: \"FLOAT_VEC4\", binder: bindUniformFloat4v },\r\n    0x8B53: { str: \"INT_VEC2\", binder: bindUniformInt2v },\r\n    0x8B54: { str: \"INT_VEC3\", binder: bindUniformInt3v },\r\n    0x8B55: { str: \"INT_VEC4\", binder: bindUniformInt4v },\r\n    0x8B56: { str: \"BOOL\", binder: bindUniformBool },\r\n    0x8B57: { str: \"BOOL_VEC2\", binder: bindUniformBool2v },\r\n    0x8B58: { str: \"BOOL_VEC3\", binder: bindUniformBool3v },\r\n    0x8B59: { str: \"BOOL_VEC4\", binder: bindUniformBool4v },\r\n    0x8B5A: { str: \"FLOAT_MAT2\", binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: \"FLOAT_MAT3\", binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: \"FLOAT_MAT4\", binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: \"SAMPLER_2D\", binder: bindSampler2D },\r\n    0x8B60: { str: \"SAMPLER_CUBE\", binder: bindSamplerCube },\r\n    0x1400: { str: \"BYTE\", binder: notImplemented },\r\n    0x1401: { str: \"UNSIGNED_BYTE\", binder: notImplemented },\r\n    0x1402: { str: \"SHORT\", binder: notImplemented },\r\n    0x1403: { str: \"UNSIGNED_SHORT\", binder: notImplemented },\r\n    0x1404: { str: \"INT\", binder: bindUniformInt },\r\n    0x1405: { str: \"UNSIGNED_INT\", binder: notImplemented },\r\n    0x1406: { str: \"FLOAT\", binder: bindUniformFloat },\r\n};\r\n\r\ninterface IShaderUniform {\r\n    value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n    loc: WebGLUniformLocation;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\ninterface IShaderAttribute {\r\n    VBO: VBO;\r\n    loc: GLint;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n    public u: { [name: string]: IShaderUniform };\r\n    public a: { [name: string]: IShaderAttribute };\r\n\r\n    private id: WebGLProgram;\r\n    private uCount: number;\r\n    private aCount: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n        function createShader(type: GLenum, source: string): WebGLShader {\r\n            const shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n\r\n            const compileSuccess = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!compileSuccess) {\r\n                console.error(gl.getShaderInfoLog(shader));\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n\r\n            return shader;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        this.id = null;\r\n        this.uCount = 0;\r\n        this.aCount = 0;\r\n\r\n        const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n        const id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n\r\n        const linkSuccess = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!linkSuccess) {\r\n            console.error(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        } else {\r\n            this.id = id;\r\n\r\n            this.introspection();\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteProgram(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public use(): void {\r\n        super.gl().useProgram(this.id);\r\n    }\r\n\r\n    public bindUniforms(): void {\r\n        const gl: WebGLRenderingContext = super.gl();\r\n        let currTextureUnitNb: number = 0;\r\n\r\n        Object.keys(this.u).forEach((uName: string) => {\r\n            const uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    const unitNb: number = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                } else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        Object.keys(this.a).forEach((aName: string) => {\r\n            const attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindUniformsAndAttributes(): void {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    }\r\n\r\n    private introspection(): void {\r\n        const gl = super.gl();\r\n\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = {};\r\n        for (let i = 0; i < this.uCount; i++) {\r\n            const uniform = gl.getActiveUniform(this.id, i);\r\n            const name = uniform.name;\r\n\r\n            this.u[name] = {\r\n                loc: gl.getUniformLocation(this.id, name),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n                value: null,\r\n            };\r\n        }\r\n\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = {};\r\n        for (let i = 0; i < this.aCount; i++) {\r\n            const attribute = gl.getActiveAttrib(this.id, i);\r\n            const name = attribute.name;\r\n\r\n            this.a[name] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport { ShaderProgram as Shader };\r\n","type LoadCallback = (success: boolean)  => void;\r\n\r\ninterface ICachedSource {\r\n    text: string;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: LoadCallback[];\r\n}\r\n\r\nconst cachedSources: { [id: string]: ICachedSource } = {};\r\n\r\n/* Fetches asynchronously the shader source from server and stores it in cache. */\r\nfunction loadSource(filename: string, callback: LoadCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedSource): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedSources[filename] === \"undefined\") {\r\n        cachedSources[filename] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            pending: true,\r\n            text: null,\r\n        };\r\n        const cached = cachedSources[filename];\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", \"./shaders/\" + filename, true);\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                cached.pending = false;\r\n\r\n                if (xhr.status === 200) {\r\n                    cached.text = xhr.responseText;\r\n                    cached.failed = false;\r\n                } else {\r\n                    console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n                    cached.failed = true;\r\n                }\r\n\r\n                callAndClearCallbacks(cached);\r\n            }\r\n        };\r\n        xhr.onerror = () => {\r\n            console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n            cached.pending = false;\r\n            cached.failed = true;\r\n            callAndClearCallbacks(cached);\r\n        };\r\n\r\n        xhr.send(null);\r\n    } else {\r\n        const cached = cachedSources[filename];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            cached.callbacks = [callback];\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSource(filename: string): string {\r\n    return cachedSources[filename].text;\r\n}\r\n\r\nexport {\r\n    getSource,\r\n    loadSource,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\n\r\nenum Usage {\r\n    DYNAMIC,\r\n    STATIC,\r\n}\r\n\r\nclass VBO extends GLResource {\r\n    public static createQuad(gl: WebGLRenderingContext, minX: number, minY: number, maxX: number, maxY: number): VBO {\r\n        const vert = [\r\n            minX, minY,\r\n            maxX, minY,\r\n            minX, maxY,\r\n            maxX, maxY,\r\n        ];\r\n\r\n        return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT, true);\r\n    }\r\n\r\n    private id: WebGLBuffer;\r\n    private size: number;\r\n    private type: GLenum;\r\n    private normalize: GLboolean;\r\n    private stride: GLsizei;\r\n    private offset: GLintptr;\r\n    private usage: Usage;\r\n\r\n    constructor(gl: WebGLRenderingContext, array: any, size: number, type: GLenum, staticUsage: boolean = true) {\r\n        super(gl);\r\n\r\n        this.id = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (staticUsage) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n        this.size = size;\r\n        this.type = type;\r\n        this.normalize = false;\r\n        this.stride = 0;\r\n        this.offset = 0;\r\n        this.usage = (staticUsage) ? Usage.STATIC : Usage.DYNAMIC;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        this.gl().deleteBuffer(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public bind(location: GLuint): void {\r\n        const gl = super.gl();\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n    }\r\n\r\n    public setData(array: any): void {\r\n        const gl = super.gl();\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (this.usage === Usage.STATIC) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n}\r\n\r\nexport { VBO };\r\n"],"sourceRoot":""}