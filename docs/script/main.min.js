!function(){"use strict";var e={753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var n=null;t.gl=n,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=n=i.getContext("webgl",e),null==n){if(t.gl=n=i.getContext("experimental-webgl",e),null==n)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=n.canvas,i=Math.floor(r.clientWidth*t),o=Math.floor(r.clientHeight*t);r.width===i&&r.height===o||(r.width=i,r.height=o)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var a=r(753),u=r(490),s=o(r(71)),c={};function l(e,t){var r=2,n=0;function i(i){function o(t){return t.replace(/#INJECT\((.*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,i||n++,0===r){var c=null;if(0===n){var l=s.getSource(e.vertexFilename),d=s.getSource(e.fragmentFilename),f=o(l),g=o(d);c=new u.Shader(a.gl,f,g)}t(c)}}s.loadSource(e.vertexFilename,i),s.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return c[e].shader},t.buildShader=l,t.registerShader=function(e,t,r){function n(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===c[e]){c[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=c[e];l(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,n(i)}))}else{var o=c[e];!0===o.pending?o.callbacks.push(r):n(o)}},t.deleteShader=function(e){void 0!==c[e]&&(null!==c[e].shader&&c[e].shader.freeGLResources(),delete c[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function n(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=r[e],o=new XMLHttpRequest;o.open("GET","./shaders/"+e,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.failed=!0),n(i))},o.onerror=function(){console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.pending=!1,i.failed=!0,n(i)},o.send(null)}else{var a=r[e];!0===a.pending?a.callbacks.push(t):(a.callbacks=[t],n(a))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var o=r(771);function a(){alert("NOT IMPLEMENTED YET")}var u={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,n)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,n)}},5120:{str:"BYTE",binder:a},5121:{str:"UNSIGNED_BYTE",binder:a},5122:{str:"SHORT",binder:a},5123:{str:"UNSIGNED_SHORT",binder:a},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:a},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},s=function(e){function t(t,r,n){var i=this;function o(e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var a=o(t.VERTEX_SHADER,r),u=o(t.FRAGMENT_SHADER,n),s=t.createProgram();return t.attachShader(s,a),t.attachShader(s,u),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?(i.id=s,i.introspection()):(console.error(t.getProgramInfoLog(s)),t.deleteProgram(s)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),n=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var o=n;u[i.type].binder(r,i.loc,o,i.value),n++}else u[i.type].binder(r,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var n=t.getActiveUniform(this.id,r),i=n.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:n.size,type:n.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var o=t.getActiveAttrib(this.id,r),a=o.name;this.a[a]={VBO:null,loc:t.getAttribLocation(this.id,a),size:o.size,type:o.type}}},t}(o.GLResource);t.Shader=s},62:function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var o,a=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(o||(o={}));var u=function(e){function t(t,r,n,i,a){void 0===a&&(a=!0);var u=e.call(this,t)||this;return u.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,u.id),a?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),u.size=n,u.type=i,u.normalize=!1,u.stride=0,u.offset=0,u.usage=a?o.STATIC:o.DYNAMIC,u}return i(t,e),t.createQuad=function(e,r,n,i,o){return new t(e,new Float32Array([r,n,i,n,r,o,i,o]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===o.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(a.GLResource);t.VBO=u},883:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;var r=function(){function e(e,t,r,n){this.left=e,this.lower=t,this.width=r,this.height=n}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.Viewport=r},633:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(753)),u=r(753),s=r(883),c=r(61),l=r(458),d=o(r(592)),f=o(r(862));r(457),function(){if(a.initGL()){var e=!0,t=!0;c.Parameters.addResizeObserver((function(){return e=!0})),c.Parameters.addColorChangeObserver((function(){return t=!0})),c.Parameters.addWatchmenModeChange(n),Page.Canvas.showLoader(!0),f.loadShaders((function(e){e?(Page.Canvas.showLoader(!1),n(c.Parameters.watchmenMode),requestAnimationFrame(r)):Page.Demopage.setErrorMessage("shaders-loading","Failed to load shaders.")}))}function r(){var n,i,o,g=c.Parameters.watchmenMode?f.EMode.WATCHMEN:f.EMode.CLASSIC,h=f.enableShader(g),v=f.getCurrentShader();(e||h)&&(n=v,(i=Page.Canvas.getAspectRatio())>=1?n.u.uCoordsAdjustment.value=[i,1]:i<1&&(n.u.uCoordsAdjustment.value=[1,1/i])),e&&(a.adjustSize(c.Parameters.supportHighDPI),s.Viewport.setFullCanvas(u.gl),e=!1),t&&(o=c.Parameters.backgroundColor,u.gl.clearColor(o.r/255,o.g/255,o.b/255,1),d.setBackgroundColor(o),t=!1),v.u.uTime.value=(0,l.getTime)(),v.u.uSharpness.value=1-c.Parameters.sharpness,v.u.uThreshold.value=1-c.Parameters.density,v.u.uScale.value=c.Parameters.scale,v.u.uSymetry.value=c.Parameters.symetry,v.u.uMaxDetails.value=c.Parameters.details,v.bindUniforms(),g===f.EMode.WATCHMEN&&u.gl.clear(u.gl.COLOR_BUFFER_BIT),u.gl.drawArrays(u.gl.TRIANGLE_STRIP,0,4),requestAnimationFrame(r)}function n(e){d.setVisibility(e)}}()},457:function(){},61:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0,r(457);var n="speed-range-id",i="mode-tabs-id",o="high-dpi-checkbox-id",a="background-color-id",u=[];function s(e,t){return e<=0?0:e>=1?1:Math.pow(e,t)}Page.ColorPicker.addObserver(a,(function(){for(var e=0,t=u;e<t.length;e++)(0,t[e])()})),Page.Controls.setVisibility(o,window.devicePixelRatio>1);var c=function(){function e(){}return Object.defineProperty(e,"speed",{get:function(){return Page.Range.getValue(n)},enumerable:!1,configurable:!0}),e.addSpeedChangeObserver=function(e){Page.Range.addObserver(n,e)},Object.defineProperty(e,"sharpness",{get:function(){return s(Page.Range.getValue("sharpness-range-id"),.05)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"density",{get:function(){var e=Page.Range.getValue("density-range-id");return e<.5?.5*s(2*e,.1):1-.5*s(2-2*e,.05)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"watchmenMode",{get:function(){return"1"===Page.Tabs.getValues(i)[0]},enumerable:!1,configurable:!0}),e.addWatchmenModeChange=function(t){Page.Tabs.addObserver(i,(function(){t(e.watchmenMode)}))},Object.defineProperty(e,"supportHighDPI",{get:function(){return Page.Checkbox.isChecked(o)},enumerable:!1,configurable:!0}),e.addResizeObserver=function(e){Page.Checkbox.addObserver(o,e),Page.Canvas.Observers.canvasResize.push(e)},Object.defineProperty(e,"scale",{get:function(){return Page.Range.getValue("scale-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"symetry",{get:function(){return 2*Page.Range.getValue("symetry-range-id")-1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"details",{get:function(){return Page.Range.getValue("details-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"backgroundColor",{get:function(){return Page.ColorPicker.getValue(a)},enumerable:!1,configurable:!0}),e.addColorChangeObserver=function(e){u.push(e)},e}();function l(){Page.Controls.setVisibility(a,c.watchmenMode)}t.Parameters=c,c.addWatchmenModeChange(l),l()},592:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.setVisibility=t.setBackgroundColor=void 0;var n=r(61);r(457);var i=Page.Canvas.getCanvasContainer(),o=document.createElement("div");o.classList.add("rorschach-face-element"),o.style.visibility="hidden",i.appendChild(o);var a=document.createElement("div");function u(e){var t=function(e){return window.btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 500 500">\n            <path stroke="none" fill="rgb('.concat(e.r,", ").concat(e.g,", ").concat(e.b,')" d="M 0,0 H 500 V 500 H 0 Z m 130.47,342.13 c 7.52,60.63 5.80,62.61 44.1,97.1 18.53,16.72 35.18,35.13 68.09,35.13 41.81,5.66 61.98,-20.86 68.18,-26.91 C 361.29,405.75 346.29,398.08 358.13,353.87 400.36,325.70 416.15,164.79 245.25,164.79 84.54,164.79 96.13,332.93 130.47,342.13 Z"/>\n        </svg>'))}(e);o.style.backgroundImage='url("data:image/svg+xml;base64,'.concat(t,'")')}a.classList.add("rorschach-face-element"),a.id="rorschach-face",a.style.visibility="hidden",i.appendChild(a),t.setBackgroundColor=u,u(n.Parameters.backgroundColor),t.setVisibility=function(e){var t=e?"":"hidden";a.style.visibility=t,o.style.visibility=t}},862:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.loadShaders=t.getCurrentShader=t.enableShader=t.EMode=void 0;var a,u=r(753),s=o(r(748)),c=r(62),l=[null,null];!function(e){e[e.CLASSIC=0]="CLASSIC",e[e.WATCHMEN=1]="WATCHMEN"}(a||(t.EMode=a={}));var d=null,f=200*Math.random()-100;function g(e,t,r,n){s.buildShader({fragmentFilename:"rorschach.frag",vertexFilename:t,injected:{SEED:f.toString(),WATCHMEN_MODE_ID:e===a.WATCHMEN?"1":"0"}},(function(t){if(null!==t)t.a.aCoords.VBO=r,l[e]=t,n(!0);else{var i="shader-loading-".concat(e);Page.Demopage.setErrorMessage(i,"Failed to load/build the shader for the mode '".concat(e,"'.")),n(!1)}}))}t.loadShaders=function(e){var t=!0;function r(r){t=t&&r;for(var n=!0,i=0,o=l;i<o.length;i++)null===o[i]&&(n=!1);n&&e(t)}var n=c.VBO.createQuad(u.gl,-1,-1,1,1);g(a.CLASSIC,"classic-mode.vert",n,r);var i=c.VBO.createQuad(u.gl,-.6,-.95,.6,.2);g(a.WATCHMEN,"watchmen-mode.vert",i,r)},t.enableShader=function(e){return d!==e&&(l[d=e].use(),l[d].bindAttributes(),!0)},t.getCurrentShader=function(){return l[d]}},458:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getTime=void 0;var n,i,o=r(61);function a(e){n=e,i=Date.now()}a(0);var u=o.Parameters.speed;function s(){return n+u*(Date.now()-i)}o.Parameters.addSpeedChangeObserver((function(){var e=o.Parameters.speed;a(s()),u=e})),t.getTime=function(){return.001*s()}}},t={};!function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}(633)}();
//# sourceMappingURL=main.min.js.map